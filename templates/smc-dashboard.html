<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SMSC Board</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <nav class="bg-gray-800 text-white px-6 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <a href="index.html" class="text-sm hover:underline">← Home</a>
      <h1 class="text-lg font-semibold">SMC Board</h1>
    </div>
    <button id="logout" class="text-sm bg-white/10 px-3 py-1 rounded hover:bg-white/20">Logout</button>
  </nav>

  <main class="max-w-5xl mx-auto px-6 py-8 space-y-8">
    <section class="bg-white rounded-lg shadow p-4">
      <h2 class="font-semibold text-lg mb-3">Quick Links</h2>
      <div class="flex flex-wrap gap-3">
        <a href="add-team.html" class="px-3 py-2 rounded bg-gray-200 hover:bg-gray-300">➕ Add New Team</a>
        <a href="existing-team.html?name=Heritage%20Football" class="px-3 py-2 rounded bg-gray-200 hover:bg-gray-300">📋 Register Team </a>
      </div>
    </section>

    <section class="bg-white rounded-lg shadow p-4">
      <h2 class="font-semibold text-lg mb-3">Add Fixture</h2>
      <form id="fx" class="grid md:grid-cols-4 gap-3">
        <input id="tournament" class="border rounded p-2" placeholder="Tournament " required>
        <select id="home" class="border rounded p-2"></select>
        <select id="away" class="border rounded p-2"></select>
        <input id="date" type="datetime-local" class="border rounded p-2" required>
        <button class="md:col-span-4 bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Save Fixture</button>
      </form>
      <p id="ok" class="text-green-700 mt-2 hidden">Fixture added.</p>
    </section>

    <section class="bg-white rounded-lg shadow p-4">
      <h2 class="font-semibold text-lg mb-3">Record Result</h2>
      <form id="rr" class="grid md:grid-cols-4 gap-3">
        <select id="fixture" class="border rounded p-2"></select>
        <input id="h" type="number" min="0" class="border rounded p-2" placeholder="Home goals" required>
        <input id="a" type="number" min="0" class="border rounded p-2" placeholder="Away goals" required>
        <button class="bg-green-600 text-white rounded py-2 hover:bg-green-700">Save Result</button>
      </form>
      <p id="rok" class="text-green-700 mt-2 hidden">Result saved.</p>
    </section>
  </main>

  <script src="../static/data.js"></script>
  <script>
    const user = getCurrentUser();
    if (!user || user.role!=='smsc') location.href='login-smc.html';

    // Populate team selects
    const teams = load('teams', []);
    const homeSel = document.getElementById('home');
    const awaySel = document.getElementById('away');
    function opt(t){ const o=document.createElement('option'); o.value=t.id; o.textContent=t.name; return o; }
    teams.forEach(t=>{ homeSel.appendChild(opt(t)); awaySel.appendChild(opt(t)); });

    // Add fixture
    document.getElementById('fx').addEventListener('submit', (e)=>{
      e.preventDefault();
      const tor = document.getElementById('tournament').value.trim();
      const homeId = homeSel.value;
      const awayId = awaySel.value;
      const dateISO = new Date(document.getElementById('date').value).toISOString();
      if (homeId===awayId) { alert('Home and Away must be different teams.'); return; }
      addFixture({ tournament:tor, homeId, awayId, dateISO });
      document.getElementById('ok').classList.remove('hidden');
      setTimeout(()=>document.getElementById('ok').classList.add('hidden'),1500);
      e.target.reset();
    });

    // Record result
    const fixtureSel = document.getElementById('fixture');
    function renderFixtureOptions(){
      fixtureSel.innerHTML='';
      const fxs = load('fixtures', []).filter(f=>!f.played);
      fxs.forEach(f=>{
        const o=document.createElement('option');
        const when = new Date(f.dateISO).toLocaleString();
        o.value=f.id; o.textContent=`${f.tournament}: ${getTeamName(f.homeId)} vs ${getTeamName(f.awayId)} • ${when}`;
        fixtureSel.appendChild(o);
      });
    }
    renderFixtureOptions();

    document.getElementById('rr').addEventListener('submit',(e)=>{
      e.preventDefault();
      const id = fixtureSel.value;
      const h = document.getElementById('h').value;
      const a = document.getElementById('a').value;
      recordResult(id, h, a);
      document.getElementById('rok').classList.remove('hidden');
      setTimeout(()=>document.getElementById('rok').classList.add('hidden'),1500);
      renderFixtureOptions();
    });

    
    function renderFixtureOptions(){
  fixtureSel.innerHTML='';
  const fxs = load('fixtures', []).filter(f=> !f.played && teamExists(f.homeId) && teamExists(f.awayId)); // <--
  if (fxs.length === 0) {
    const o = document.createElement('option');
    o.value = ''; o.textContent = 'No fixtures available';
    fixtureSel.appendChild(o);
    return;
  }
  fxs.forEach(f=>{
    const o=document.createElement('option');
    const when = new Date(f.dateISO).toLocaleString();
    o.value=f.id; o.textContent=`${f.tournament}: ${getTeamName(f.homeId)} vs ${getTeamName(f.awayId)} • ${when}`;
    fixtureSel.appendChild(o);
  });
}


    document.getElementById('logout').onclick = ()=>{ logout(); location.href='index.html'; };
  </script>
</body>
</html>
