<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Update Players • {{ team.name }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Navbar -->
  <nav class="bg-gray-800 text-white">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="{{ url_for('team_dashboard') }}" class="text-sm hover:underline">← Back to Dashboard</a>
        <h1 class="text-lg font-semibold">Manage Team & Players</h1>
      </div>
      <div class="flex items-center gap-2">
        <a href="{{ url_for('logout') }}" class="text-sm bg-white/10 px-3 py-1 rounded hover:bg-white/20">Logout</a>
      </div>
    </div>
  </nav>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="space-y-2 mb-4">
          {% for category, message in messages %}
            <div class="px-4 py-2 rounded text-sm
              {% if category == 'success' %} bg-green-50 text-green-800 border border-green-200
              {% elif category == 'error' %} bg-red-50 text-red-800 border border-red-200
              {% else %} bg-gray-50 text-gray-800 border border-gray-200
              {% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- TEAM DETAILS -->
    <section class="bg-white border rounded-lg shadow-sm p-5 mb-6">
      <h2 class="text-xl font-semibold mb-3">Team Details</h2>
      <p class="text-sm text-gray-600 mb-4">
        Team: <span class="font-medium">{{ team.name }}</span> •
        ID: <span class="font-mono">{{ team.team_id }}</span>
        {% if team.department %} • Department: <span class="font-medium">{{ team.department }}</span>{% endif %}
      </p>

      <form method="POST" action="{{ url_for('update_profile') }}" class="grid md:grid-cols-2 gap-4">
        {# {{ csrf_token() }} if using CSRF #}
        <input type="hidden" name="action" value="update_team" />
        <div>
          <label class="block text-sm mb-1">Manager Name</label>
          <input name="manager_name" value="{{ team.manager_name or '' }}" class="w-full border rounded p-2" />
        </div>
        <div>
          <label class="block text-sm mb-1">Manager Contact</label>
          <input name="manager_contact" value="{{ team.manager_contact or '' }}" class="w-full border rounded p-2" />
        </div>
        <div class="md:col-span-2">
          <button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save Team</button>
        </div>
      </form>
    </section>

    <!-- EDIT EXISTING PLAYERS -->
  <section class="bg-white border rounded-lg shadow-sm p-5 mb-6">
  <div class="flex items-center justify-between mb-3">
    <h2 class="text-xl font-semibold">Edit Players (Active)</h2>
    <span class="text-sm text-gray-600">{{ players|length }} player(s)</span>
  </div>

  {% if players %}
    <div class="grid md:grid-cols-2 gap-4">
      {% for p in players %}
        <div class="border rounded-lg p-4">
          <div class="flex items-center justify-between mb-2">
            <div class="font-medium">{{ p.name or "Unnamed Player" }}</div>
            <span class="text-xs text-gray-500">ID: {{ p.id }}</span>
          </div>

          {# --- UPDATE DETAILS (per-player form) --- #}
          <form method="POST" action="{{ url_for('update_profile') }}" class="space-y-3">
            <input type="hidden" name="action" value="update_players" />

            <div>
              <label class="block text-xs text-gray-600 mb-1">Name</label>
              <input name="player_{{ p.id }}_name" value="{{ p.name or '' }}" class="w-full border rounded p-2" />
            </div>

            <div>
              <label class="block text-xs text-gray-600 mb-1">Roll Number</label>
              <input name="player_{{ p.id }}_roll_number"
                     type="number" inputmode="numeric" step="1" min="1"
                     value="{{ p.roll_number if p.roll_number is not none else '' }}"
                     class="w-full border rounded p-2" />
              <p class="text-xs text-gray-500 mt-1">Must be a unique integer.</p>
            </div>

            <div>
              <label class="block text-xs text-gray-600 mb-1">Contact</label>
              <input name="player_{{ p.id }}_contact" value="{{ p.contact or '' }}" class="w-full border rounded p-2" />
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-gray-600 mb-1">Department</label>
                <input name="player_{{ p.id }}_department" value="{{ p.department or '' }}" class="w-full border rounded p-2" />
              </div>
              <div>
                <label class="block text-xs text-gray-600 mb-1">Year</label>
                <input name="player_{{ p.id }}_year" value="{{ p.year or '' }}" class="w-full border rounded p-2" />
              </div>
            </div>

            <button type="submit"
                    class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
              Update Details
            </button>
          </form>

          {# --- REMOVE PLAYER (separate form; no nesting) --- #}
          <form method="POST" action="{{ url_for('update_profile') }}" class="mt-3"
                onsubmit="return confirm('Remove this player?');">
            <input type="hidden" name="action" value="remove_player" />
            <input type="hidden" name="player_id" value="{{ p.id }}" />
            <button type="submit"
                    class="text-sm px-3 py-2 bg-red-50 text-red-700 rounded hover:bg-red-100">
              Remove Player
            </button>
          </form>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-sm text-gray-500">No active players found for this team.</p>
  {% endif %}
</section>


    <!-- ADD NEW PLAYER -->
    <section class="bg-white border rounded-lg shadow-sm p-5">
      <h2 class="text-xl font-semibold mb-3">Add New Player</h2>
      <form method="POST" action="{{ url_for('update_profile') }}" class="grid md:grid-cols-2 gap-4">
        {# {{ csrf_token() }} #}
        <input type="hidden" name="action" value="add_player" />

        <div class="md:col-span-2">
          <label class="block text-sm mb-1">Name</label>
          <input name="new_player_name" required class="w-full border rounded p-2" />
        </div>

        <div>
          <label class="block text-sm mb-1">Roll Number</label>
          <input name="new_player_roll" type="number" inputmode="numeric" step="1" min="1" required
                 class="w-full border rounded p-2" />
          <p class="text-xs text-gray-500 mt-1">Must be a unique integer.</p>
        </div>

        <div>
          <label class="block text-sm mb-1">Contact</label>
          <input name="new_player_contact" class="w-full border rounded p-2" />
        </div>

        <div>
          <label class="block text-sm mb-1">Department</label>
          <input name="new_player_department" value="{{ team.department or '' }}" class="w-full border rounded p-2" />
        </div>

        <div>
          <label class="block text-sm mb-1">Year</label>
          <input name="new_player_year" class="w-full border rounded p-2" />
        </div>

        <div class="md:col-span-2">
          <button class="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700">Add Player</button>
        </div>
      </form>
      <p class="text-xs text-gray-500 mt-2">Tip: Roll numbers are globally unique and required.</p>
    </section>
  </main>
</body>
</html>
